#!/usr/bin/env python
# -*- coding: utf-8 -*-

import argparse

import os

# sys.path.append(os.path.join(os.path.dirname(os.path.realpath(__file__)), '../'))

from shaibos.util.log import get_logger
from shaibos.load.from_yaml import load_invoices_from_yaml
from shaibos.save.to_html import save_html

# ---

logger = get_logger()

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description='Export invoices to HTML.')
    parser.add_argument('-i', '--input_yaml', type=str, required=True, help='YAML file with invoices')
    parser.add_argument('-t', '--template', type=str, required=True, help='Jinja2 template for rendering the invoice')
    parser.add_argument('-o', '--output_dir', type=str, required=True, help='Output directory for HTML files')
    args = parser.parse_args()

    if not os.path.isdir(args.output_dir):
        os.makedirs(args.output_dir)

    invoices = load_invoices_from_yaml(args.input_yaml)

    for invoice_number_prefix in invoices:
        for invoice in invoices[invoice_number_prefix]:
            output_html_path = os.path.join(args.output_dir, invoice.filename_prefix() + '.html')
            save_html(invoice=invoice, template_path=args.template, output_path=output_html_path)
            logger.info('Saved HTML invoice %s' % output_html_path)
